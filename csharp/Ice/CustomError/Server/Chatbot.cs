// Copyright (c) ZeroC, Inc.

using VisitorCenter;

namespace CustomErrorServer;

/// <summary>Chatbot is an Ice servant that implements Slice interface Greeter.</summary>
internal class Chatbot : GreeterDisp_
{
    private const int MaxLength = 7;

    /// <inheritdoc/>
    // Implements the abstract method Greet from the GreeterDisp_ class generated by the Slice compiler.
    // This variant is the synchronous implementation.
    public override string Greet(string name, Ice.Current current)
    {
        Console.WriteLine($"Dispatching greet request {{ name = '{name}' }}");

        GreeterException? exception = name switch
        {
            "" => new GreeterException("Name is empty!", GreeterError.EmptyName),
            "jimmy" => new GreeterException($"Away until {DateTime.Now + TimeSpan.FromMinutes(5)}", GreeterError.Away),
            _ when name.Length > MaxLength =>
                new GreeterException("Name is longer than maximum!", GreeterError.NameTooLong),
            _ => null
        };

        if (exception != null)
        {
            throw exception;
        }

        return $"Hello, {name}!";
    }
}
